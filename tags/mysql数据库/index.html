<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  
  <title>Tag: mysql数据库 | life4code</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  
    <meta name="author" content="wangts">
  
  
  <meta name="description" content="life code python java">
<meta property="og:type" content="website">
<meta property="og:title" content="life4code">
<meta property="og:url" content="http://blog.life4code.com/tags/mysql数据库/">
<meta property="og:site_name" content="life4code">
<meta property="og:description" content="life code python java">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="life4code">
<meta name="twitter:description" content="life code python java">

  
    <link rel="alternate" href="/atom.xml" title="life4code" type="application/atom+xml">
  
  
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>

<body>
  <div class="wrapper">
    <header id="header">
  <div class="title">
    <h1><a href="/">life4code</a></h1>
    <p><a href="/">coding for life</a></p>
  </div>
  <nav class="nav">
    <ul>
      
        <li><a href="/">Home</a></li>
      
        <li><a href="/archives">Archives</a></li>
      
      
        <li><a href="/atom.xml">RSS</a></li>
      
    </ul>
    <div class="clearfix"></div>
  </nav>
  <div class="clearfix"></div>
</header>

    <div class="content">


<h2 class="archives-title tag"><span>mysql数据库</span></h2>



  
    <article class="post">
  <header>
    
      <div class="icon"></div>
      <a href="/2014/08/16/mysql事务隔离级别/">
  <time datetime="2014-08-16T15:38:19.000Z">
    8月 16 2014
  </time>
</a>
    
    
  
    <h1 class="title"><a href="/2014/08/16/mysql事务隔离级别/">mysql事务隔离级别</a></h1>
  

  </header>
  
  <div class="entry">
    
      <p>　　最近学习了一下mysql的数据库的事务隔离和mysql如何处理并发更新的操作，在任何时候并发操作在系统中都会出现，本片博客就学习mysql的隔离级别做一下总结，欢迎拍砖。</p>
<p>mysql事务的隔离级别一共有四个：分别为：<br>读未提交（READ UNCOMMITTED）：<br>　　这个隔离级别会出现，事务A读取到另一个事务B未提交的内容，有可能事务B最后rollback了，事务A读取的内容就不正确了。<br>读已提交（READ COMMITTED）：<br>　　这个隔离级别是事务A读取到另一个事务B已经提交的内容，事务A在一个事务中前后两次读取的内容不同。<br>可重复读（REPEATABLE READ）：<br>　　事务A读取数据，无论事务B做更新操作还是删除操作，事务A读取的内容，在事务A在未提交事务之前，读取的内容都是一样的，知道事务A提交，再次读取数据。<br>串行化（SERIALIZABLE）：<br>　　事务A在未提交或者rollback之前，其他的任务事务都不能修改数据，只有等待事务A已经提交。<br>　　更改mysql数据库事务的隔离级别的sql语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="operator"><span class="keyword">SET</span> [<span class="keyword">SESSION</span> | <span class="keyword">GLOBAL</span>] <span class="keyword">TRANSACTION</span> <span class="keyword">ISOLATION</span> <span class="keyword">LEVEL</span> </span></div><div class="line">{<span class="keyword">READ</span> UNCOMMITTED | <span class="keyword">READ</span> COMMITTED | REPEATABLE <span class="keyword">READ</span> | <span class="keyword">SERIALIZABLE</span>}</div></pre></td></tr></table></figure>

<h2 id="下面结合示例，解释以上四种隔离级别：">下面结合示例，解释以上四种隔离级别：</h2>
<p>一，READ UNCOMMITTED</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#设置事务的隔离级别</span></div><div class="line">mysql&gt; set session transaction isolation level read uncommitted;</div><div class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</div><div class="line"><span class="comment">#【1】事务A开启事务</span></div><div class="line">mysql&gt; start transaction;</div><div class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</div><div class="line"><span class="comment">#【2】事务B开启事务</span></div><div class="line">mysql&gt; start transaction;</div><div class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</div><div class="line"><span class="comment">#【3】事务A查询数据</span></div><div class="line">mysql&gt; select * <span class="keyword">from</span> account;</div><div class="line">+----+----------+--------+</div><div class="line">| id | name     | amount |</div><div class="line">+----+----------+--------+</div><div class="line">|  <span class="number">1</span> | zhangsan |   <span class="number">1000</span> |</div><div class="line">|  <span class="number">2</span> | wangwu   |   <span class="number">1000</span> |</div><div class="line">+----+----------+--------+</div><div class="line"><span class="number">2</span> rows <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</div><div class="line"><span class="comment">#【4】事务B更新‘zhangsan’的数据</span></div><div class="line">mysql&gt; update account set amount = amount + <span class="number">500</span> where name = <span class="string">'zhangsan'</span>;</div><div class="line">Query OK, <span class="number">1</span> row affected (<span class="number">0.00</span> sec)</div><div class="line">Rows matched: <span class="number">1</span>  Changed: <span class="number">1</span>  Warnings: <span class="number">0</span></div><div class="line"><span class="comment">#【5】事务A第二次查询数据</span></div><div class="line">mysql&gt; select * <span class="keyword">from</span> account;</div><div class="line">+----+----------+--------+</div><div class="line">| id | name     | amount |</div><div class="line">+----+----------+--------+</div><div class="line">|  <span class="number">1</span> | zhangsan |   <span class="number">1500</span> |</div><div class="line">|  <span class="number">2</span> | wangwu   |   <span class="number">1000</span> |</div><div class="line">+----+----------+--------+</div><div class="line"><span class="number">2</span> rows <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</div><div class="line"><span class="comment">#【6】事务B把update语句做回滚操作</span></div><div class="line">mysql&gt; rollback;</div><div class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.08</span> sec)</div><div class="line"><span class="comment">#【7】事务A第三次查询数据</span></div><div class="line">mysql&gt; select * <span class="keyword">from</span> account;</div><div class="line">+----+----------+--------+</div><div class="line">| id | name     | amount |</div><div class="line">+----+----------+--------+</div><div class="line">|  <span class="number">1</span> | zhangsan |   <span class="number">1000</span> |</div><div class="line">|  <span class="number">2</span> | wangwu   |   <span class="number">1000</span> |</div><div class="line">+----+----------+--------+</div><div class="line"><span class="number">2</span> rows <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</div></pre></td></tr></table></figure>

<p>解释示例的步骤解释：<br>【1】【2】事务A和事务B都开启了一个事务；（ps：这里的掩饰放在一个流程中，现实中事务A和事务B是两个mysql的回话，分别开启事务。）<br>【3】事务A查询出数据库的内容，‘zhangsan’账户金额为1000；<br>【4】事务B更新‘zhangsan’的账户金额，增加500；<br>【5】事务A再次查询，查询到事务B增加‘zhangsan’账户金额的500；<br>【6】事务B把更新进行回滚操作；<br>【7】事务A第三次查询到‘zhangsan’的账户金额少了500；<br>所谓的读未提交，就是事务A在第【5】步骤的时候读取到事务B更新但是未提交事务的操作，如果事务B最后rollback了，事务A在第【5】步读取的数据就是错误数据，也称作脏数据，所以读未提交会发生脏读情况。</p>
<p>二，READ COMMITTED</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#设置事务的隔离级别为read committed</span></div><div class="line">mysql&gt; set session transaction isolation level read committed;</div><div class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</div><div class="line"><span class="comment">#【1】事务A开启事务</span></div><div class="line">mysql&gt; start transaction;</div><div class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</div><div class="line"><span class="comment">#【2】事务B开启事务</span></div><div class="line">mysql&gt; start transaction;</div><div class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</div><div class="line"><span class="comment">#【3】事务A第一次查询数据</span></div><div class="line">mysql&gt; select * <span class="keyword">from</span> account;</div><div class="line">+----+----------+--------+</div><div class="line">| id | name     | amount |</div><div class="line">+----+----------+--------+</div><div class="line">|  <span class="number">1</span> | zhangsan |   <span class="number">1000</span> |</div><div class="line">|  <span class="number">2</span> | wangwu   |   <span class="number">1000</span> |</div><div class="line">+----+----------+--------+</div><div class="line"><span class="number">2</span> rows <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</div><div class="line"><span class="comment">#【4】事务B更新‘zhangsan’账户金额</span></div><div class="line">mysql&gt; update account set amount = amount - <span class="number">500</span> where name = <span class="string">'zhangsan'</span>;</div><div class="line">Query OK, <span class="number">1</span> row affected (<span class="number">0.00</span> sec)</div><div class="line">Rows matched: <span class="number">1</span>  Changed: <span class="number">1</span>  Warnings: <span class="number">0</span></div><div class="line"><span class="comment">#【5】事务A第二次查询数据</span></div><div class="line">mysql&gt; select * <span class="keyword">from</span> account;</div><div class="line">+----+----------+--------+</div><div class="line">| id | name     | amount |</div><div class="line">+----+----------+--------+</div><div class="line">|  <span class="number">1</span> | zhangsan |   <span class="number">1000</span> |</div><div class="line">|  <span class="number">2</span> | wangwu   |   <span class="number">1000</span> |</div><div class="line">+----+----------+--------+</div><div class="line"><span class="number">2</span> rows <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</div><div class="line"><span class="comment">#【6】事务B提交自己update更新语句</span></div><div class="line">mysql&gt; commit;</div><div class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.08</span> sec)</div><div class="line"><span class="comment">#【7】事务A第三次查询数据</span></div><div class="line">mysql&gt; select * <span class="keyword">from</span> account;</div><div class="line">+----+----------+--------+</div><div class="line">| id | name     | amount |</div><div class="line">+----+----------+--------+</div><div class="line">|  <span class="number">1</span> | zhangsan |    <span class="number">500</span> |</div><div class="line">|  <span class="number">2</span> | wangwu   |   <span class="number">1000</span> |</div><div class="line">+----+----------+--------+</div><div class="line"><span class="number">2</span> rows <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</div><div class="line"><span class="comment">#【8】事务A提交</span></div><div class="line">mysql&gt; commit;</div><div class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</div></pre></td></tr></table></figure>

<p>解释示例的步骤解释：<br>【1】【2】事务A和事务B都开启事务；<br>【3】事务A进行第一次数据查询；<br>【4】事务B执行update语句；<br>【5】事务A第二次查询数据，发现数据和第一次查询一样，事务B的更新没有体现；<br>【6】事务Bcommit提交事务更新；<br>【7】事务A第三次查询数据，发现’zhangsan‘的账户金额少了500；<br>【8】事务A提交。<br>所谓读已提交：就是事务A在他的事务中，前后可以读取到另一个事务对数据的更新，在事务B提交事务的前后，事务A两次读取的内容不相同，这就是不可重复读。<br>READ COMMITTED 事务级别解决了 READ UNCOMMITTED 中脏读的问题，但是还有不可重复读的问题。</p>
<p>三：REPEATABLE READ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#设置事务的隔离级别为repeatable read</span></div><div class="line">mysql&gt; set session transaction isolation level repeatable read;</div><div class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</div><div class="line"><span class="comment">#【1】事务A开启事务</span></div><div class="line">mysql&gt; start transaction;</div><div class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</div><div class="line"><span class="comment">#【2】事务B开启事务</span></div><div class="line">mysql&gt; start transaction;</div><div class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</div><div class="line"><span class="comment">#【3】事务A第一次查询</span></div><div class="line">mysql&gt; select * <span class="keyword">from</span> account;</div><div class="line">+----+----------+--------+</div><div class="line">| id | name     | amount |</div><div class="line">+----+----------+--------+</div><div class="line">|  <span class="number">1</span> | zhangsan |   <span class="number">1000</span> |</div><div class="line">|  <span class="number">2</span> | wangwu   |   <span class="number">1000</span> |</div><div class="line">+----+----------+--------+</div><div class="line"><span class="number">2</span> rows <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</div><div class="line"><span class="comment">#【4】事务B更新’zhangsan‘金额</span></div><div class="line">mysql&gt; update account set amount = amount + <span class="number">500</span> where name = <span class="string">'zhangsan'</span>;</div><div class="line">Query OK, <span class="number">1</span> row affected (<span class="number">0.00</span> sec)</div><div class="line">Rows matched: <span class="number">1</span>  Changed: <span class="number">1</span>  Warnings: <span class="number">0</span></div><div class="line"><span class="comment">#【5】事务A第二次查询</span></div><div class="line">mysql&gt; select * <span class="keyword">from</span> account;</div><div class="line">+----+----------+--------+</div><div class="line">| id | name     | amount |</div><div class="line">+----+----------+--------+</div><div class="line">|  <span class="number">1</span> | zhangsan |   <span class="number">1000</span> |</div><div class="line">|  <span class="number">2</span> | wangwu   |   <span class="number">1000</span> |</div><div class="line">+----+----------+--------+</div><div class="line"><span class="number">2</span> rows <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</div><div class="line"><span class="comment">#【6】事务B提交update语句</span></div><div class="line">mysql&gt; commit;</div><div class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.07</span> sec)</div><div class="line"><span class="comment">#【7】事务A第三次查询</span></div><div class="line">mysql&gt; select * <span class="keyword">from</span> account;</div><div class="line">+----+----------+--------+</div><div class="line">| id | name     | amount |</div><div class="line">+----+----------+--------+</div><div class="line">|  <span class="number">1</span> | zhangsan |   <span class="number">1000</span> |</div><div class="line">|  <span class="number">2</span> | wangwu   |   <span class="number">1000</span> |</div><div class="line">+----+----------+--------+</div><div class="line"><span class="number">2</span> rows <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</div><div class="line"><span class="comment">#【8】事务A提交本次事务</span></div><div class="line">mysql&gt; commit;</div><div class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</div><div class="line"><span class="comment">#【9】事务A第四次查询记录</span></div><div class="line">mysql&gt; select * <span class="keyword">from</span> account;</div><div class="line">+----+----------+--------+</div><div class="line">| id | name     | amount |</div><div class="line">+----+----------+--------+</div><div class="line">|  <span class="number">1</span> | zhangsan |   <span class="number">1500</span> |</div><div class="line">|  <span class="number">2</span> | wangwu   |   <span class="number">1000</span> |</div><div class="line">+----+----------+--------+</div><div class="line"><span class="number">2</span> rows <span class="keyword">in</span> set (<span class="number">0.01</span> sec)</div></pre></td></tr></table></figure>

<p>解释示例的步骤解释：<br>【1】【2】事务A和事务B开启事务；<br>【3】事务A第一次查询数据结果；<br>【4】事务B更新’zhangsan‘的金额；<br>【5】事务A第二次查询数据，发现’zhangsan‘的金额并没有改变；<br>【6】事务B提交本次事务；<br>【7】事务A第三次次查询数据，查询事务B已经提交的数据，发现’zhangsan‘的金额还是没有改变<br>【8】事务A提交本次事务；<br>【9】执行事务A的回话第四次查询数据，这时可以查询到事务B更新的’zhangsan‘的数据。<br>在可重复读隔离级别下，【3】【5】【7】三次查询都在事务A中，这三次无论什么时候查询都查询不到事务B更新的内容，保证了同一个事务里，查询的结果都是事务开始时的状态，只有当事务A提交事务，再次开启一个事务查询的时候，会查询到事务B提交的内容，但是这种隔离级别下会出现幻读的问题（事务B做的事务insert操作，事务A未查询到事务B insert的记录，如果事务A更新所有的数据，会把事务B insert的语句给更新）。</p>
<p>下面的例子演示一下幻读的情况：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#【1】事务A开启事务</span></div><div class="line">mysql&gt; start transaction;</div><div class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</div><div class="line"><span class="comment">#【2】事务B开启事务</span></div><div class="line">mysql&gt; start transaction;</div><div class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</div><div class="line"><span class="comment">#【3】事务A第一次查询</span></div><div class="line">mysql&gt; select * <span class="keyword">from</span> account;</div><div class="line">+----+----------+--------+</div><div class="line">| id | name     | amount |</div><div class="line">+----+----------+--------+</div><div class="line">|  <span class="number">1</span> | zhangsan |   <span class="number">1000</span> |</div><div class="line">|  <span class="number">2</span> | wangwu   |   <span class="number">1000</span> |</div><div class="line">+----+----------+--------+</div><div class="line"><span class="number">2</span> rows <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</div><div class="line"><span class="comment">#【4】事务B插入一条数据</span></div><div class="line">mysql&gt; insert into account values(<span class="number">3</span>,<span class="string">'lisi'</span>,<span class="number">2000</span>);</div><div class="line">Query OK, <span class="number">1</span> row affected (<span class="number">0.00</span> sec)</div><div class="line"><span class="comment">#【5】事务A第二次查询</span></div><div class="line">mysql&gt; select * <span class="keyword">from</span> account;</div><div class="line">+----+----------+--------+</div><div class="line">| id | name     | amount |</div><div class="line">+----+----------+--------+</div><div class="line">|  <span class="number">1</span> | zhangsan |   <span class="number">1000</span> |</div><div class="line">|  <span class="number">2</span> | wangwu   |   <span class="number">1000</span> |</div><div class="line">+----+----------+--------+</div><div class="line"><span class="number">2</span> rows <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</div><div class="line"><span class="comment">#【6】事务B提交本次事务</span></div><div class="line">mysql&gt; commit;</div><div class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.05</span> sec)</div><div class="line"><span class="comment">#【7】事务A第三次查询</span></div><div class="line">mysql&gt; select * <span class="keyword">from</span> account;</div><div class="line">+----+----------+--------+</div><div class="line">| id | name     | amount |</div><div class="line">+----+----------+--------+</div><div class="line">|  <span class="number">1</span> | zhangsan |   <span class="number">1000</span> |</div><div class="line">|  <span class="number">2</span> | wangwu   |   <span class="number">1000</span> |</div><div class="line">+----+----------+--------+</div><div class="line"><span class="number">2</span> rows <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</div><div class="line"><span class="comment">#【8】事务A更新查询出来的数据</span></div><div class="line">mysql&gt; update account set amount = amount + <span class="number">500</span>;</div><div class="line">Query OK, <span class="number">3</span> rows affected (<span class="number">0.00</span> sec)</div><div class="line">Rows matched: <span class="number">3</span>  Changed: <span class="number">3</span>  Warnings: <span class="number">0</span></div><div class="line"><span class="comment">#【9】事务A第四次查询</span></div><div class="line">mysql&gt; select * <span class="keyword">from</span> account;</div><div class="line">+----+----------+--------+</div><div class="line">| id | name     | amount |</div><div class="line">+----+----------+--------+</div><div class="line">|  <span class="number">1</span> | zhangsan |   <span class="number">1500</span> |</div><div class="line">|  <span class="number">2</span> | wangwu   |   <span class="number">1500</span> |</div><div class="line">|  <span class="number">3</span> | lisi     |   <span class="number">2500</span> |</div><div class="line">+----+----------+--------+</div><div class="line"><span class="number">3</span> rows <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</div></pre></td></tr></table></figure>

<p>示例说明：<br>【1】【2】事务A和事务B都开启事务；<br>【3】事务A第一次查询；<br>【4】事务B插入一条数据；<br>【5】事务A第二次查询，未查询出事务B插入的语句；<br>【6】事务B提交本次事务，插入语句生效；<br>【7】事务A第三次查询，还是未查询出事务B插入的语句；<br>【8】事务A更新查询出的所有语句，发现更新的结果是3条，不是两条；<br>【9】事务A第四次查询，查询到事务B插入的数据，并且也更新了这条数据；<br>在【8】【9】步骤的时候，出现了幻读的情况。</p>
<p>四，serializable</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#设置事务的隔离级别为serializable</span></div><div class="line">mysql&gt; set session transaction isolation level serializable;</div><div class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</div><div class="line"><span class="comment">#【1】事务A开启事务</span></div><div class="line">mysql&gt; start transaction;</div><div class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</div><div class="line"><span class="comment">#【2】事务B开启事务</span></div><div class="line">mysql&gt; start transaction;</div><div class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</div><div class="line"><span class="comment">#【3】事务A第一次查询</span></div><div class="line">mysql&gt; select * <span class="keyword">from</span> account;</div><div class="line">+----+----------+--------+</div><div class="line">| id | name     | amount |</div><div class="line">+----+----------+--------+</div><div class="line">|  <span class="number">1</span> | zhangsan |   <span class="number">1000</span> |</div><div class="line">|  <span class="number">2</span> | wangwu   |   <span class="number">1000</span> |</div><div class="line">+----+----------+--------+</div><div class="line"><span class="number">2</span> rows <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</div><div class="line"><span class="comment">#【4】事务B做插入操作，这时这个insert语句会等待，不立即执行成功</span></div><div class="line">mysql&gt; insert into account values(<span class="number">3</span>,<span class="string">'lisi'</span>,<span class="number">2000</span>);</div><div class="line"><span class="comment">#【5】事务A第二次查询</span></div><div class="line">mysql&gt; select * <span class="keyword">from</span> account;</div><div class="line">+----+----------+--------+</div><div class="line">| id | name     | amount |</div><div class="line">+----+----------+--------+</div><div class="line">|  <span class="number">1</span> | zhangsan |   <span class="number">1000</span> |</div><div class="line">|  <span class="number">2</span> | wangwu   |   <span class="number">1000</span> |</div><div class="line">+----+----------+--------+</div><div class="line"><span class="number">2</span> rows <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</div><div class="line"><span class="comment">#【6】事务A提交本次事务</span></div><div class="line">mysql&gt; commit;</div><div class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.00</span> sec)</div><div class="line"><span class="comment">#【7】事务B的insert语句执行</span></div><div class="line">Query OK, <span class="number">1</span> row affected (<span class="number">12.81</span> sec)</div><div class="line"><span class="comment">#【8】执行事务A的回话再次查询</span></div><div class="line">mysql&gt; select * <span class="keyword">from</span> account;</div><div class="line">+----+----------+--------+</div><div class="line">| id | name     | amount |</div><div class="line">+----+----------+--------+</div><div class="line">|  <span class="number">1</span> | zhangsan |   <span class="number">1000</span> |</div><div class="line">|  <span class="number">2</span> | wangwu   |   <span class="number">1000</span> |</div><div class="line">|  <span class="number">3</span> | lisi     |   <span class="number">2000</span> |</div><div class="line">+----+----------+--------+</div><div class="line"><span class="number">3</span> rows <span class="keyword">in</span> set (<span class="number">0.00</span> sec)</div></pre></td></tr></table></figure>

<p>示例说明：<br>【1】【2】 事务A和事务B都开启事务；<br>【3】事务A第一次查询记录；<br>【4】事务B做插入一条新记录，但是这时insert语句不会成功，一直是等待执行；<br>【5】事务A第二次查询记录；<br>【6】事务A提交本次事务，这时【7】事务B 的insert语句执行成功；<br>【8】执行事务A的回话，再次查询；<br>如果事务的隔离级别是serializable，那么一个事务未提交，另一个事务不能做更新删除或者插入操作，另一个事务只能等待。</p>
<p>以上就是mysql的是四种事务隔离级别：<br>如果按照更新修改数据的安全性比较：<br>read uncommitted &lt; read committed &lt; repeatable read &lt; serializable<br>如果按照数据库性能比较：<br>read uncommitted &gt; read committed &gt; repeatable read &gt; serializable</p>
<p>mysql默认的事务隔离级别是：repeatable read<br>理解了事务的隔离级之后，还需要学习数据库的更新丢失问题，以及mysql中锁是怎么添加的的，有什么锁，下次博客进行更新总结。</p>

    
  </div>
  <footer class="end-sep">
    
      
      
    
    <div class="clearfix"></div>
  </footer>
</article>


  

  <nav id="pagination">
  
  
  <div class="clearfix"></div>
</nav>

</div>
  </div>
  <footer id="footer"><div class="copyright">
  
  &copy; 2014 <a href="/">wangts</a>
  
</div>
<div class="theme-copyright">
  Theme by <a href="https://github.com/orderedlist" target="_blank">orderedlist</a>
   | 
  Redesign by <a href="http://heroicyang.com/" target="_blank">Heroic Yang</a>
</div>
<div class="clearfix"></div></footer>
  <script src="http://cdn.staticfile.org/jquery/1.8.1/jquery.min.js"></script>
<script src="/js/scale.fix.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
  (function($){
    $('.fancybox').fancybox();
  })(jQuery);
</script>


</body>
</html>